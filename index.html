<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Dragalia Lost 3D Models</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="css/sidebar.css" rel="stylesheet">

</head>

<body>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <div class="sidebar-heading">Settings </div>
      <form>
        <div class="form-group">
          <select class="form-control" id="char_set">
            <option selected = "selected" value = '0'>Regular Adventurers</option>
            <option disabled = 'disabled' value = '1'>Allies (Coming soon)</option>
            <option disabled = 'disabled' value = '2'>Enemies (Coming soon)</option>
          </select>
          <p style = "border-bottom: medium"></p>
          <select class="form-control" id="raritySelect">
            <option selected = "selected">Any rarity</option>
            <option>3 stars</option>
            <option>4 stars</option>
            <option>5 stars</option>
          </select>
          <select class="form-control" id="elementSelect">
            <option selected = "selected">Any element</option>
            <option>Flame</option>
            <option>Water</option>
            <option>Wind</option>
            <option>Light</option>
            <option>Shadow</option>
          </select>
          <select class="form-control" id="weaponSelect">
            <option selected = "selected">Any weapon</option>
            <option>Sword</option>
            <option>Blade</option>
            <option>Dagger</option>
            <option>Axe</option>
            <option>Lance</option>
            <option>Bow</option>
            <option>Wand</option>
            <option>Staff</option>
          </select>
          <p style = "border-bottom: medium"></p>
          <select class="form-control mt-6 bg-light" id="advSelect" style = "width: 15rem" autofocus>
          </select>
          <p style = "border-bottom: medium"></p>
          <select class="form-control" id="faceSelect" style = 'display:none'>
            <option value ='1'>Face 1</option>
            <option selected = "selected" value = '2'>Face 2</option>
            <option value = '3'>Face 3</option>
            <option value = '4'>Face 4</option>
            <option value = '5'>Face 5</option>
            <option value = '6'>Face 6</option>
            <option value = '7'>Face 7</option>
            <option value = '8'>Face 8</option>
            <option value = '9'>Face 9</option>
          </select>
        </div>
      </form>
      <div id = 'ctrl_btn' style = 'display:none'>
        <div class = "button-toolbar mb-1">
          <button id = 'still_btn' class="btn btn-info">Still</button>
          <button id = 'bob_btn' class="btn btn-info">Bob</button>
        </div>
        <div class = "button-toolbar mb-1">
          <button id = 'walk_btn' class="btn btn-info">Walk</button>
          <button id = 'run_btn' class="btn btn-info">Run</button>
        </div>
        <br>
        <p class = 'mt-6 mb-0 border-top' style="padding-left: 10px;width:100%">Win animation settings</p>
        <div class="btn-group btn-group-toggle" data-toggle="buttons" id = 'wintype'>
          <label class="btn btn-secondary active">
            <input type="radio" name="winstyle" id="defaultWin" checked>Default
          </label>
          <label class="btn btn-secondary">
            <input type="radio" name="winstyle" id="weaponWin">Weapon
          </label>
          <label class="btn btn-secondary">
            <input type="radio" name="winstyle" id="spWin">Special
          </label>
        </div>
        <select class="form-control" id="weaponWStyle" style = 'display:none'>
          <option selected = "selected" value ='SWD'>Sword</option>
          <option value = 'KAT'>Blade</option>
          <option value = 'DAG'>Dagger</option>
          <option value = 'AXE'>Axe</option>
          <option value = 'LAN'>Lance</option>
          <option value = 'BOW'>Bow</option>
          <option value = 'ROD'>Wand</option>
          <option value = 'CAN'>Staff</option>
        </select>
        <button id = 'win_btn' class="btn btn-success" style = "width:100%;">Win</button>
        </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-sm navbar-light">
        <button class="btn btn-primary" id="menu-toggle">Settings</button>
        <span style="padding-left:5px"></span>
        <p class ="nav-item"> Using resources from <a href="https://notte.moe/" target="_blank">notte.moe</a></p>
      </nav>

      <div class="container-fluid">
        <iframe id="ifm" src="" style="height:500px; width:500px; border: none"></iframe>
      </div>
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  <!-- Menu Toggle Script -->
  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
    var buffer = 20; //scroll bar buffer
    var iframe = document.getElementById('ifm');

    function pageY(elem) {
        return elem.offsetParent ? (elem.offsetTop + pageY(elem.offsetParent)) : elem.offsetTop;
    }

    function pageX(elem) {
        return elem.offsetParent ? (elem.offsetLeft + pageX(elem.offsetParent)) : elem.offsetLeft;
    }

    function resizeIframe() {

        var width = document.documentElement.clientWidth;
        var height = document.documentElement.clientHeight;
        if (width >= 768)
        {
          width -= pageX(document.getElementById('ifm'))+ buffer ;
          width = (width < 0) ? 0 : width;
          height -= pageY(document.getElementById('ifm'))+ buffer ;
          height = (height < 0) ? 0 : height;
        }
        else
        {
          height -= pageY(document.getElementById('ifm'))+ buffer ;
          height = (height < 0) ? 0 : height;
        }
        var size = (width > height) ? height : width;
        iframe.style.height = size + 'px';
        iframe.style.width = size + 'px';
    }

    // .onload doesn't work with IE8 and older.
    if (iframe.attachEvent) {
        iframe.attachEvent("onload", resizeIframe);
    } else {
        iframe.onload=resizeIframe;
    }

    window.onresize = resizeIframe;
    window.onload = resizeIframe;
  </script>
  <!-- Filter Script -->
  <script type='module'>
    import adv from 'https://dgk3593.github.io/cs50web-project0/js/adv_list.js';
    import sp_adv from 'https://dgk3593.github.io/DLModel/js/sp_adv.js';
    let advBox = document.getElementById('advSelect');

    function defaultWinClicked()
    {
      console.log('default Win');
      // console.log(document.getElementById('defaultWin').style);
    }
    function weaponWinClicked()
    {
      console.log('weapon Win');
      // document.getElementById('weaponWStyle').style.display= 'inline';
      // console.log(document.getElementById('weaponWin').style);
    }
    function spWinClicked()
    {
      console.log('sp Win');
      // document.getElementById('weaponWStyle').style.display= 'inline';
      // console.log(document.getElementById('spWin').style);
    }
    function filter()
    {
      let weapon = document.getElementById('weaponSelect').value;
      let rarity = document.getElementById('raritySelect').value[0];
      let ele = document.getElementById('elementSelect').value;
      let result = adv;
      if (weapon != 'Any weapon')
      {
        result = result.filter(d => d.weapon === weapon);
      }
      if (rarity != 'A')
      {
        result = result.filter(d => d.rarity === parseInt(rarity));
      }
      if (ele != 'Any element')
      {
        result = result.filter(d => d.element === ele);
      }

      advBox.innerHTML = '';
      var listItem = document.createElement('option');
      listItem.innerHTML = 'Choose an adventurer';
      listItem.value = '0';
      listItem.disabled = 'disabled';
      listItem.selected = 'selected';
      advBox.appendChild(listItem);

      result.forEach(advhandle);
    }

    function advhandle(adv)
    {
      let img_link = 'images/icon/' + adv.cid + '_r0' + adv.rarity + '.png';
      var listItem = document.createElement('option');
      listItem.innerHTML = adv.name;
      listItem.value = adv.cid;
      advBox.appendChild(listItem);
    }

    function advSelected()
    {
      let selected = document.getElementById('advSelect');
      let face = document.getElementById('faceSelect').value;
      let cid = selected.value;
      document.getElementById('faceSelect').style.display= 'inline';  // Show face control
      document.getElementById('ctrl_btn').style.display= 'inline';  // Show control button

      let link = "https://notte.moe/dl-fbx/c" + cid +'/-/face' + face;
      iframe.src = link;
    }

    function faceSelected()
    {
      let cid = document.getElementById('advSelect').value;
      let face = document.getElementById('faceSelect').value;
      if (cid === '0')
      {
        return false;
      }
      let link = iframe.src
      link = link.substr(0,link.length-1) + face;
      iframe.src = link;
    }

    function Still()
    {
      let cid = document.getElementById('advSelect').value;
      let face = document.getElementById('faceSelect').value;
      if (cid === '0')
      {
        return false;
      }
      let link = "https://notte.moe/dl-fbx/c" + cid +'/-/face' + face;
      iframe.src = link;
    }
    function Bob()
    {
      let cid = document.getElementById('advSelect').value;
      let face = document.getElementById('faceSelect').value;
      if (cid === '0')
      {
        return false;
      }
      let link = "https://notte.moe/dl-fbx/c" + cid + "/cmn+CMN_MWM_03" + '/face' + face;
      iframe.src = link;
    }
    function Walk()
    {
      let cid = document.getElementById('advSelect').value;
      let face = document.getElementById('faceSelect').value;
      if (cid === '0')
      {
        return false;
      }
      let link = "https://notte.moe/dl-fbx/c" + cid + "/cmn+CMN_MWM_01" + '/face' + face;
      iframe.src = link;
    }
    function Run()
    {
      let cid = document.getElementById('advSelect').value;
      let face = document.getElementById('faceSelect').value;
      if (cid === '0')
      {
        return false;
      }
      let link = "https://notte.moe/dl-fbx/c" + cid + "/cmn+CMN_MWM_02" + '/face' + face;
      iframe.src = link;
    }
    function Win()
    {
      let cid = document.getElementById('advSelect').value;
      let face = document.getElementById('faceSelect').value;
      if (cid === '0')
      {
        return false;
      }
      let sp = 0;
      let temp = sp_adv.filter(d => d.cid === cid);
      if (temp.length != 0) // Not a special adventurer
      {
        sp = 1;  // is a special adventurer
      }
      temp = adv.filter(d => d.cid === cid);
      let weapon = temp[0].weapon;
      let wincode = '';
      switch (weapon)
      {
        case 'Sword':
          wincode = 'SWD';
          break;
        case 'Blade':
          wincode = 'KAT';
          break;
        case 'Dagger':
          wincode = 'DAG';
          break;
        case 'Axe':
          wincode = 'AXE';
          break;
        case 'Lance':
          wincode = 'LAN';
          break;
        case 'Bow':
          wincode = 'BOW';
          break;
        case 'Wand':
          wincode = 'ROD';
          break;
        case 'Staff':
          wincode = 'CAN';
          break;
      }
      let link = '';
      if (sp == 0)
      {
        link = "https://notte.moe/dl-fbx/c" + cid + "/win+" + wincode + "_WIN_01" + '/face' + face;
      }
      else
      {
        link = "https://notte.moe/dl-fbx/c" + cid + "/wins+" + wincode + "_WIN_01_" + cid.replace('_','') + '/face' + face;
      }
      iframe.src = link;
    }

    function init()
    {
      resizeIframe();
      filter();
      document.getElementById('weaponSelect').addEventListener("change", filter);
      document.getElementById('raritySelect').addEventListener("change", filter);
      document.getElementById('elementSelect').addEventListener("change", filter);
      document.getElementById('advSelect').addEventListener("change", advSelected);
      document.getElementById('faceSelect').addEventListener("change", faceSelected);
      document.getElementById('defaultWin').addEventListener("click", defaultWinClicked);
      document.getElementById('weaponWin').addEventListener("click", weaponWinClicked);
      document.getElementById('spWin').addEventListener("click", spWinClicked);
      document.getElementById('still_btn').addEventListener("click", Still);
      document.getElementById('bob_btn').addEventListener("click", Bob);
      document.getElementById('walk_btn').addEventListener("click", Walk);
      document.getElementById('run_btn').addEventListener("click", Run);
      document.getElementById('win_btn').addEventListener("click", Win);
    }

    window.onload = init;
  </script>
</body>

</html>
