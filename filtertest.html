<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="images/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <title>Filter Test</title>
  </head>
  <body>
    <form>
      <div class="form-group">
        <label for="raritySelect">Rarity</label>
        <select class="form-control" id="raritySelect">
          <option selected = "selected">Any</option>
          <option>3 stars</option>
          <option>4 stars</option>
          <option>5 stars</option>
        </select>
        <label for="elementSelect">Element</label>
        <select class="form-control" id="elementSelect">
          <option selected = "selected">Any</option>
          <option>Flame</option>
          <option>Water</option>
          <option>Wind</option>
          <option>Light</option>
          <option>Shadow</option>
        </select>
        <label for="weaponSelect">Weapon Type</label>
        <select class="form-control" id="weaponSelect">
          <option selected = "selected">Any</option>
          <option>Sword</option>
          <option>Blade</option>
          <option>Dagger</option>
          <option>Axe</option>
          <option>Lance</option>
          <option>Bow</option>
          <option>Wand</option>
          <option>Staff</option>
        </select>
        <label for="advSelect">Weapon Type</label>
        <select class="form-control" id="advSelect">
        </select>
      </div>
    </form>
    <ul id="adv_list"></ul>
    <script type='module'>
      import adv from 'https://dgk3593.github.io/cs50web-project0/js/adv_list.js';
      let list = document.getElementById('adv_list');
      let advBox = document.getElementById('advSelect');

      document.getElementById('weaponSelect').addEventListener("change", filter);
      document.getElementById('raritySelect').addEventListener("change", filter);
      document.getElementById('elementSelect').addEventListener("change", filter);


      function filter()
      {
        let weapon = document.getElementById('weaponSelect').value;
        let rarity = document.getElementById('raritySelect').value[0];
        let ele = document.getElementById('elementSelect').value;
        let result = adv;
        if (weapon != 'Any')
        {
          result = result.filter(d => d.weapon === weapon);
        }
        if (rarity != 'A')
        {
          result = result.filter(d => d.rarity === parseInt(rarity));
        }
        if (ele != 'Any')
        {
          result = result.filter(d => d.element === ele);
        }

        list.innerHTML = '';
        advBox.innerHTML = '';
        result.forEach(advhandle);
      }

      function advhandle(adv)
      {
        let img_link = 'images/icon/' + adv.cid + '_r0' + adv.rarity + '.png';
        var icon = document.createElement("img");
        icon.src = img_link;
        list.appendChild(icon);
        var listItem = document.createElement('option');
        listItem.innerHTML = adv.name;
        listItem.value = adv.cid;
        advBox.appendChild(listItem);
      }

      window.onload = filter;
    </script>
  </body>

</html>
